<!DOCTYPE html>
<html lang="en">
	<title>soundrepl example</title>

  <script src="/src/3rd/teoria.js"></script>
  <script src="/src/main.js"></script>
  <script src="/src/tracks/getlucky.js"></script>
  <style>
    html, body { font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif; font-weight: 200; }
    article, section { clear: both; }
    article > label > h3 {
      float: left;
    }
    article > label > input {
      float: left;
    }
  </style>
  <script>
    (function (window) { 
      'use strict';
      var bpm = 116;
      var repl = soundrepl.create();

      window.onload = function() {
        window.ac = new (window.AudioContext || window.webkitAudioContext);

        Object.keys(getlucky.entries).forEach(function(item) {
          var article = document.createElement('article');
          article.innerHTML = '<label><input type="checkbox" data-name="'+item+'" class="sample" />';
          article.innerHTML += '<h3>' + item + '</h3></label>';
          document.querySelector('#samples').appendChild(article);
          
        });
      };

      window.playSelected = function() {
        [].slice.apply(document.querySelectorAll('.sample')).map(function (cb) {
          if (cb.checked) return cb.getAttribute('data-name');
          else return '';
        }).filter(function (f) { 
          return f; 
        }).forEach(function (sampleName) {
          getlucky.entries[sampleName].play(ac, bpm);
        });
      };

      window.playCustom = function() {
        var code = document.querySelector('#custom').value;
        var input;
        try {
          input = new Function('sample', 'return ' + code)(repl.create);
        } catch (err) {
          window.alert(err);
        }
          if ('play' in input && typeof input.play === 'function') 
          input.play(ac, bpm);
        else //sound primative
          repl.create(input).play(ac, bpm);
      };
    })(window);
  </script>

  <body>
    <header>
      <h1>SOUNDREPL Example</h1>
    </header>
    <section id="samples"></section>
    <section>
      <button onclick="playSelected()">Play</button>
    </section>
    <section>
      <textarea id="custom" keydown="if (evt.keyCode === 13) playCustom()"></textarea> 
      <button onclick="playCustom()">Play Custom</button>
    </section>
  </body>    
</html>